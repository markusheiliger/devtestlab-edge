{
    "$schema": "https://raw.githubusercontent.com/Azure/azure-devtestlab/master/schemas/2016-11-28/dtlArtifacts.json",
    "title": "Reset VM Password",
    "description": "Uses the VMAccess extension to reset the built-in administrator account.",
    "tags": [
        "Linux"
    ],
    "targetOsType": "Linux",
    "parameters": {
        "userName": {
            "type": "string",
            "displayName": "User name",
            "description": "The user account to reset."
        },
        "password": {
            "type": "securestring",
            "displayName": "Password",
            "description": "New password for the user name"
        },
        "resetSSH": {
            "type": "bool",
            "defaultValue": false,
            "allowedValues": [
                true,
                false
            ],
            "metadata": {
                "description": "Whether to reset ssh"
            }
        },
        "sshKey": {
            "type": "string",
            "defaultValue": "",
            "metadata": {
                "description": "The new public key"
            }
        }
    },
    "runAzureVMExtension": {
        "publisher": "Microsoft.OSTCExtensions",
        "type": "VMAccessForLinux",
        "typeHandlerVersion": "1.4",
        "autoUpgradeMinorVersion": true,
        "settings": {
            "UserName": "[parameters('userName')]"
        },
        "protectedSettings": {
            "password": "[parameters('password')]",
            "reset_ssh": "[parameters('resetSSH')]",
            "ssh_key": "[parameters('sshKey')]"
        }
    }
}